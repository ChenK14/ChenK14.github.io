{"ast":null,"code":"import _asyncToGenerator from\"/Users/chenk/performance/ChenK14.github.io/chenk14.github.io/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/chenk/performance/ChenK14.github.io/chenk14.github.io/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/chenk/performance/ChenK14.github.io/chenk14.github.io/node_modules/@babel/runtime/regenerator/index.js\";import{useEffect,useState}from\"react\";import{Spinner}from\"react-bootstrap\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function PerformanceTimeline(_ref){var google=_ref.google,filters=_ref.filters;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),timeline=_useState2[0],setTimeline=_useState2[1];var _useState3=useState(filters),_useState4=_slicedToArray(_useState3,2),currentFilters=_useState4[0],setCurrentFilters=_useState4[1];useEffect(function(){if(google&&(!timeline||currentFilters!==filters)){google.charts.load(\"current\",{packages:[\"timeline\"]});google.charts.setOnLoadCallback(function(){return drawChart(filters,google,setTimeline);});setCurrentFilters(filters);}},[currentFilters,filters,google,timeline]);return/*#__PURE__*/_jsxs(\"div\",{children:[!google&&/*#__PURE__*/_jsx(Spinner,{}),/*#__PURE__*/_jsx(\"div\",{id:\"timeline\",className:!google?\"d-none\":\"\"})]});}export default PerformanceTimeline;var getPerformanceObject=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(filters){var data,retList,counter;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"string.json\").then(function(res){return res.json();});case 2:data=_context.sent;retList=[];counter=1;filters=filters.map(function(filter){return filter.name;});data.forEach(function(entry){if(!entry.name.endsWith(\"duration\")&&!entry.name.startsWith(\"@grammarly\")&&filters.includes(entry.entryType)&&(filters.includes('frog calls')||!filters.includes('frog calls')&&!entry.name.includes('frog'))){var retEntry={displayName:entry.name,type:entry.entryType,name:entry.name,starts:entry.startTime,ends:entry.startTime+entry.duration};var nameStartIndex=0;if(entry.name.startsWith(\"[fedops] \")){nameStartIndex=9;}var nameEndIndex=entry.name.length-1;if(entry.name.includes(\"started\")){nameEndIndex=entry.name.indexOf(\" started\");retEntry.starts=entry.startTime;retEntry.ends=entry.startTime;}else if(entry.name.includes(\"finished\")){nameEndIndex=entry.name.indexOf(\" finished\");}else if(entry.name.includes(\"ended\")){nameEndIndex=entry.name.indexOf(\" ended\");}retEntry.name=entry.name.slice(nameStartIndex,nameEndIndex+1);var found=false;retList.forEach(function(ret){if(ret.name===retEntry.name){ret.ends=entry.startTime+entry.duration;found=true;}});if(!found){retEntry.displayName=entry.name.startsWith(\"https://\")?\"fetch call \".concat(counter++):entry.name.slice(nameStartIndex,nameEndIndex+1);retList.push(retEntry);}}});return _context.abrupt(\"return\",retList);case 8:case\"end\":return _context.stop();}}},_callee);}));return function getPerformanceObject(_x){return _ref2.apply(this,arguments);};}();var drawChart=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(filters,google,setTimeline){var container,newChart,dataTable,data,i,options;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:container=document.getElementById(\"timeline\");container.style.height=\"8000px\";newChart=new google.visualization.Timeline(container);dataTable=new google.visualization.DataTable();_context2.next=6;return getPerformanceObject(filters);case 6:data=_context2.sent;dataTable.addColumn({type:\"string\",id:\"row label\"});dataTable.addColumn({type:\"string\",id:\"bar label\"});dataTable.addColumn({type:\"string\",role:\"tooltip\"});dataTable.addColumn({type:\"number\",id:\"Start\"});dataTable.addColumn({type:\"number\",id:\"End\"});for(i=0;i<data.length;i++){dataTable.addRow([data[i].type,data[i].displayName,\"<div style=\\\"border:solid 1px #000000; padding: 10px\\\">\\n\\t\\t\\t\\t\\t\\t\\t<h2>\".concat(data[i].name,\"</h2>\\n\\t\\t\\t\\t\\t\\t\\t<div style=\\\"font-size: medium; font-family: 'Trirong', sans-serif\\\">\").concat(parseInt(data[i].starts),\" mil - \").concat(parseInt(data[i].ends),\" mil</div>\\n\\t\\t\\t\\t\\t\\t\\t<div style=\\\"font-size: medium; font-family: 'Trirong', sans-serif\\\">Duration: \").concat(parseInt(data[i].ends-data[i].starts),\" mil</div>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t\\t\"),parseInt(data[i].starts)*5,parseInt(data[i].ends)*5]);}options={width:\"100%\",height:\"100%\",timeline:{colorByRowLabel:true,groupByRowLabel:false}};newChart.draw(dataTable,options);setTimeline(newChart);case 16:case\"end\":return _context2.stop();}}},_callee2);}));return function drawChart(_x2,_x3,_x4){return _ref3.apply(this,arguments);};}();","map":{"version":3,"sources":["/Users/chenk/performance/ChenK14.github.io/chenk14.github.io/src/PerformanceTimeline.js"],"names":["useEffect","useState","Spinner","PerformanceTimeline","google","filters","timeline","setTimeline","currentFilters","setCurrentFilters","charts","load","packages","setOnLoadCallback","drawChart","getPerformanceObject","fetch","then","res","json","data","retList","counter","map","filter","name","forEach","entry","endsWith","startsWith","includes","entryType","retEntry","displayName","type","starts","startTime","ends","duration","nameStartIndex","nameEndIndex","length","indexOf","slice","found","ret","push","container","document","getElementById","style","height","newChart","visualization","Timeline","dataTable","DataTable","addColumn","id","role","i","addRow","parseInt","options","width","colorByRowLabel","groupByRowLabel","draw"],"mappings":"ybAAA,OAASA,SAAT,CAAoBC,QAApB,KAAoC,OAApC,CACA,OAASC,OAAT,KAAwB,iBAAxB,C,wFAEA,QAASC,CAAAA,mBAAT,MAAkD,IAAnBC,CAAAA,MAAmB,MAAnBA,MAAmB,CAAXC,OAAW,MAAXA,OAAW,CAChD,cAAgCJ,QAAQ,CAAC,IAAD,CAAxC,wCAAOK,QAAP,eAAiBC,WAAjB,eACA,eAA4CN,QAAQ,CAACI,OAAD,CAApD,yCAAOG,cAAP,eAAuBC,iBAAvB,eACAT,SAAS,CAAC,UAAM,CACd,GAAII,MAAM,GAAK,CAACE,QAAD,EAAYE,cAAc,GAAKH,OAApC,CAAV,CAAwD,CACtDD,MAAM,CAACM,MAAP,CAAcC,IAAd,CAAmB,SAAnB,CAA8B,CAAEC,QAAQ,CAAE,CAAC,UAAD,CAAZ,CAA9B,EACAR,MAAM,CAACM,MAAP,CAAcG,iBAAd,CAAgC,iBAC9BC,CAAAA,SAAS,CAACT,OAAD,CAAUD,MAAV,CAAkBG,WAAlB,CADqB,EAAhC,EAGAE,iBAAiB,CAACJ,OAAD,CAAjB,CACD,CACF,CARQ,CAQN,CAACG,cAAD,CAAiBH,OAAjB,CAA0BD,MAA1B,CAAkCE,QAAlC,CARM,CAAT,CAUA,mBACE,uBACG,CAACF,MAAD,eAAW,KAAC,OAAD,IADd,cAEE,YAAK,EAAE,CAAC,UAAR,CAAmB,SAAS,CAAE,CAACA,MAAD,CAAU,QAAV,CAAqB,EAAnD,EAFF,GADF,CAMD,CAED,cAAeD,CAAAA,mBAAf,CAEA,GAAMY,CAAAA,oBAAoB,2FAAG,iBAAOV,OAAP,iKACRW,CAAAA,KAAK,CAAC,aAAD,CAAL,CAAqBC,IAArB,CAA0B,SAACC,GAAD,QAASA,CAAAA,GAAG,CAACC,IAAJ,EAAT,EAA1B,CADQ,QACrBC,IADqB,eAEvBC,OAFuB,CAEb,EAFa,CAGvBC,OAHuB,CAGb,CAHa,CAI3BjB,OAAO,CAACA,OAAO,CAACkB,GAAR,CAAY,SAACC,MAAD,QAAYA,CAAAA,MAAM,CAACC,IAAnB,EAAZ,CAAR,CACAL,IAAI,CAACM,OAAL,CAAa,SAACC,KAAD,CAAW,CACtB,GACE,CAACA,KAAK,CAACF,IAAN,CAAWG,QAAX,CAAoB,UAApB,CAAD,EACA,CAACD,KAAK,CAACF,IAAN,CAAWI,UAAX,CAAsB,YAAtB,CADD,EAEAxB,OAAO,CAACyB,QAAR,CAAiBH,KAAK,CAACI,SAAvB,CAFA,GAGI1B,OAAO,CAACyB,QAAR,CAAiB,YAAjB,CAAD,EACA,CAACzB,OAAO,CAACyB,QAAR,CAAiB,YAAjB,CAAD,EAAiC,CAACH,KAAK,CAACF,IAAN,CAAWK,QAAX,CAAoB,MAApB,CAJrC,CADF,CAME,CACA,GAAME,CAAAA,QAAQ,CAAG,CACfC,WAAW,CAAEN,KAAK,CAACF,IADJ,CAEfS,IAAI,CAAEP,KAAK,CAACI,SAFG,CAGfN,IAAI,CAAEE,KAAK,CAACF,IAHG,CAIfU,MAAM,CAAER,KAAK,CAACS,SAJC,CAKfC,IAAI,CAAEV,KAAK,CAACS,SAAN,CAAkBT,KAAK,CAACW,QALf,CAAjB,CAQA,GAAIC,CAAAA,cAAc,CAAG,CAArB,CACA,GAAIZ,KAAK,CAACF,IAAN,CAAWI,UAAX,CAAsB,WAAtB,CAAJ,CAAwC,CACtCU,cAAc,CAAG,CAAjB,CACD,CACD,GAAIC,CAAAA,YAAY,CAAGb,KAAK,CAACF,IAAN,CAAWgB,MAAX,CAAoB,CAAvC,CACA,GAAId,KAAK,CAACF,IAAN,CAAWK,QAAX,CAAoB,SAApB,CAAJ,CAAoC,CAClCU,YAAY,CAAGb,KAAK,CAACF,IAAN,CAAWiB,OAAX,CAAmB,UAAnB,CAAf,CACAV,QAAQ,CAACG,MAAT,CAAkBR,KAAK,CAACS,SAAxB,CACAJ,QAAQ,CAACK,IAAT,CAAgBV,KAAK,CAACS,SAAtB,CACD,CAJD,IAIO,IAAIT,KAAK,CAACF,IAAN,CAAWK,QAAX,CAAoB,UAApB,CAAJ,CAAqC,CAC1CU,YAAY,CAAGb,KAAK,CAACF,IAAN,CAAWiB,OAAX,CAAmB,WAAnB,CAAf,CACD,CAFM,IAEA,IAAIf,KAAK,CAACF,IAAN,CAAWK,QAAX,CAAoB,OAApB,CAAJ,CAAkC,CACvCU,YAAY,CAAGb,KAAK,CAACF,IAAN,CAAWiB,OAAX,CAAmB,QAAnB,CAAf,CACD,CACDV,QAAQ,CAACP,IAAT,CAAgBE,KAAK,CAACF,IAAN,CAAWkB,KAAX,CAAiBJ,cAAjB,CAAiCC,YAAY,CAAG,CAAhD,CAAhB,CAEA,GAAII,CAAAA,KAAK,CAAG,KAAZ,CACAvB,OAAO,CAACK,OAAR,CAAgB,SAACmB,GAAD,CAAS,CACvB,GAAIA,GAAG,CAACpB,IAAJ,GAAaO,QAAQ,CAACP,IAA1B,CAAgC,CAC9BoB,GAAG,CAACR,IAAJ,CAAWV,KAAK,CAACS,SAAN,CAAkBT,KAAK,CAACW,QAAnC,CACAM,KAAK,CAAG,IAAR,CACD,CACF,CALD,EAMA,GAAI,CAACA,KAAL,CAAY,CACVZ,QAAQ,CAACC,WAAT,CAAuBN,KAAK,CAACF,IAAN,CAAWI,UAAX,CAAsB,UAAtB,uBACLP,OAAO,EADF,EAEnBK,KAAK,CAACF,IAAN,CAAWkB,KAAX,CAAiBJ,cAAjB,CAAiCC,YAAY,CAAG,CAAhD,CAFJ,CAGAnB,OAAO,CAACyB,IAAR,CAAad,QAAb,EACD,CACF,CACF,CA9CD,EAL2B,gCAoDpBX,OApDoB,wDAAH,kBAApBN,CAAAA,oBAAoB,6CAA1B,CAuDA,GAAMD,CAAAA,SAAS,2FAAG,kBAAOT,OAAP,CAAgBD,MAAhB,CAAwBG,WAAxB,sKACVwC,SADU,CACEC,QAAQ,CAACC,cAAT,CAAwB,UAAxB,CADF,CAEhBF,SAAS,CAACG,KAAV,CAAgBC,MAAhB,CAAyB,QAAzB,CACMC,QAHU,CAGC,GAAIhD,CAAAA,MAAM,CAACiD,aAAP,CAAqBC,QAAzB,CAAkCP,SAAlC,CAHD,CAIVQ,SAJU,CAIE,GAAInD,CAAAA,MAAM,CAACiD,aAAP,CAAqBG,SAAzB,EAJF,wBAKGzC,CAAAA,oBAAoB,CAACV,OAAD,CALvB,QAKVe,IALU,gBAMhBmC,SAAS,CAACE,SAAV,CAAoB,CAAEvB,IAAI,CAAE,QAAR,CAAkBwB,EAAE,CAAE,WAAtB,CAApB,EACAH,SAAS,CAACE,SAAV,CAAoB,CAAEvB,IAAI,CAAE,QAAR,CAAkBwB,EAAE,CAAE,WAAtB,CAApB,EACAH,SAAS,CAACE,SAAV,CAAoB,CAAEvB,IAAI,CAAE,QAAR,CAAkByB,IAAI,CAAE,SAAxB,CAApB,EACAJ,SAAS,CAACE,SAAV,CAAoB,CAAEvB,IAAI,CAAE,QAAR,CAAkBwB,EAAE,CAAE,OAAtB,CAApB,EACAH,SAAS,CAACE,SAAV,CAAoB,CAAEvB,IAAI,CAAE,QAAR,CAAkBwB,EAAE,CAAE,KAAtB,CAApB,EAEA,IAASE,CAAT,CAAa,CAAb,CAAgBA,CAAC,CAAGxC,IAAI,CAACqB,MAAzB,CAAiCmB,CAAC,EAAlC,CAAsC,CACpCL,SAAS,CAACM,MAAV,CAAiB,CACfzC,IAAI,CAACwC,CAAD,CAAJ,CAAQ1B,IADO,CAEfd,IAAI,CAACwC,CAAD,CAAJ,CAAQ3B,WAFO,sFAIRb,IAAI,CAACwC,CAAD,CAAJ,CAAQnC,IAJA,sGAKuDqC,QAAQ,CACpE1C,IAAI,CAACwC,CAAD,CAAJ,CAAQzB,MAD4D,CAL/D,mBAOI2B,QAAQ,CAAC1C,IAAI,CAACwC,CAAD,CAAJ,CAAQvB,IAAT,CAPZ,qHAQiEyB,QAAQ,CAC9E1C,IAAI,CAACwC,CAAD,CAAJ,CAAQvB,IAAR,CAAejB,IAAI,CAACwC,CAAD,CAAJ,CAAQzB,MADuD,CARzE,iDAaf2B,QAAQ,CAAC1C,IAAI,CAACwC,CAAD,CAAJ,CAAQzB,MAAT,CAAR,CAA2B,CAbZ,CAcf2B,QAAQ,CAAC1C,IAAI,CAACwC,CAAD,CAAJ,CAAQvB,IAAT,CAAR,CAAyB,CAdV,CAAjB,EAgBD,CACK0B,OA9BU,CA8BA,CACdC,KAAK,CAAE,MADO,CAEdb,MAAM,CAAE,MAFM,CAGd7C,QAAQ,CAAE,CAAE2D,eAAe,CAAE,IAAnB,CAAyBC,eAAe,CAAE,KAA1C,CAHI,CA9BA,CAoChBd,QAAQ,CAACe,IAAT,CAAcZ,SAAd,CAAyBQ,OAAzB,EACAxD,WAAW,CAAC6C,QAAD,CAAX,CArCgB,yDAAH,kBAATtC,CAAAA,SAAS,sDAAf","sourcesContent":["import { useEffect, useState } from \"react\";\nimport { Spinner } from \"react-bootstrap\";\n\nfunction PerformanceTimeline({ google, filters }) {\n  const [timeline, setTimeline] = useState(null);\n  const [currentFilters, setCurrentFilters] = useState(filters);\n  useEffect(() => {\n    if (google && (!timeline|| currentFilters !== filters)) {\n      google.charts.load(\"current\", { packages: [\"timeline\"] });\n      google.charts.setOnLoadCallback(() =>\n        drawChart(filters, google, setTimeline)\n      )\n      setCurrentFilters(filters)\n    }\n  }, [currentFilters, filters, google, timeline]);\n\n  return (\n    <div>\n      {!google && <Spinner />}\n      <div id=\"timeline\" className={!google ? \"d-none\" : \"\"} />\n    </div>\n  );\n}\n\nexport default PerformanceTimeline;\n\nconst getPerformanceObject = async (filters) => {\n  const data = await fetch(\"string.json\").then((res) => res.json());\n  let retList = [];\n  let counter = 1;\n  filters=filters.map((filter) => filter.name)\n  data.forEach((entry) => {\n    if (\n      !entry.name.endsWith(\"duration\") &&\n      !entry.name.startsWith(\"@grammarly\") &&\n      filters.includes(entry.entryType)&&\n        ((filters.includes('frog calls'))||\n        (!filters.includes('frog calls')&&!entry.name.includes('frog')))\n    ) {\n      const retEntry = {\n        displayName: entry.name,\n        type: entry.entryType,\n        name: entry.name,\n        starts: entry.startTime,\n        ends: entry.startTime + entry.duration,\n      };\n\n      let nameStartIndex = 0;\n      if (entry.name.startsWith(\"[fedops] \")) {\n        nameStartIndex = 9;\n      }\n      let nameEndIndex = entry.name.length - 1;\n      if (entry.name.includes(\"started\")) {\n        nameEndIndex = entry.name.indexOf(\" started\");\n        retEntry.starts = entry.startTime;\n        retEntry.ends = entry.startTime;\n      } else if (entry.name.includes(\"finished\")) {\n        nameEndIndex = entry.name.indexOf(\" finished\");\n      } else if (entry.name.includes(\"ended\")) {\n        nameEndIndex = entry.name.indexOf(\" ended\");\n      }\n      retEntry.name = entry.name.slice(nameStartIndex, nameEndIndex + 1);\n\n      let found = false;\n      retList.forEach((ret) => {\n        if (ret.name === retEntry.name) {\n          ret.ends = entry.startTime + entry.duration;\n          found = true;\n        }\n      });\n      if (!found) {\n        retEntry.displayName = entry.name.startsWith(\"https://\")\n          ? `fetch call ${counter++}`\n          : entry.name.slice(nameStartIndex, nameEndIndex + 1);\n        retList.push(retEntry);\n      }\n    }\n  });\n  return retList;\n};\n\nconst drawChart = async (filters, google, setTimeline) => {\n  const container = document.getElementById(\"timeline\");\n  container.style.height = \"8000px\";\n  const newChart = new google.visualization.Timeline(container);\n  const dataTable = new google.visualization.DataTable();\n  const data = await getPerformanceObject(filters);\n  dataTable.addColumn({ type: \"string\", id: \"row label\" });\n  dataTable.addColumn({ type: \"string\", id: \"bar label\" });\n  dataTable.addColumn({ type: \"string\", role: \"tooltip\" });\n  dataTable.addColumn({ type: \"number\", id: \"Start\" });\n  dataTable.addColumn({ type: \"number\", id: \"End\" });\n\n  for (let i = 0; i < data.length; i++) {\n    dataTable.addRow([\n      data[i].type,\n      data[i].displayName,\n      `<div style=\"border:solid 1px #000000; padding: 10px\">\n\t\t\t\t\t\t\t<h2>${data[i].name}</h2>\n\t\t\t\t\t\t\t<div style=\"font-size: medium; font-family: 'Trirong', sans-serif\">${parseInt(\n                data[i].starts\n              )} mil - ${parseInt(data[i].ends)} mil</div>\n\t\t\t\t\t\t\t<div style=\"font-size: medium; font-family: 'Trirong', sans-serif\">Duration: ${parseInt(\n                data[i].ends - data[i].starts\n              )} mil</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`,\n      parseInt(data[i].starts) * 5,\n      parseInt(data[i].ends) * 5,\n    ]);\n  }\n  const options = {\n    width: \"100%\",\n    height: \"100%\",\n    timeline: { colorByRowLabel: true, groupByRowLabel: false },\n  };\n\n  newChart.draw(dataTable, options);\n  setTimeline(newChart);\n};\n"]},"metadata":{},"sourceType":"module"}